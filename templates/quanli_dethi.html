<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Danh s√°ch ƒë·ªÅ thi</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/styles_quanli_dethi.css') }}">
</head>
<body>
    <!-- menu -->
    <div class="navbar">
    <a href="{{ url_for('upload.danh_sach_de_thi') }}">Trang Ch·ªß</a>
    <div class="subnav">
        <button class="subnavbtn">Qu·∫£n l√≠ ƒë·ªÅ thi <i class="fa fa-caret-down"></i></button>
        <div class="subnav-content">
        <a href="../upload">T·∫°o ƒë·ªÅ thi</a>
        <!-- <a href="#team">Team</a>
        <a href="#careers">Careers</a> -->
        </div>
    </div>
    <div class="subnav">
        <button class="subnavbtn">Ng∆∞·ªùi d√πng <i class="fa fa-caret-down"></i></button>
        <div class="subnav-content">
        <a href="{{ url_for('users.users') }}">Danh s√°ch ng∆∞·ªùi d√πng</a>
        <!-- <a href="#deliver">Deliver</a>
        <a href="#package">Package</a>
        <a href="#express">Express</a> -->
        </div>
    </div>
    <!-- <div class="subnav">
        <button class="subnavbtn">Partners <i class="fa fa-caret-down"></i></button>
        <div class="subnav-content">
        <a href="#link1">Link 1</a>
        <a href="#link2">Link 2</a>
        <a href="#link3">Link 3</a>
        <a href="#link4">Link 4</a>
        </div>
    </div> -->
    <a href="{{ url_for('xuli_dethi.lam_bai') }}">V√†o Thi</a>
    <a href="#contact">Li√™n h·ªá</a>
    
    </div>
     <!--  -->
    <h2 style="color: red;">Danh s√°ch ƒë·ªÅ thi</h2>
    <!-- Th√¥ng b√°o flash -->
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        <div id="flash-message" style="
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 9999;
                background-color: lightgreen;
                color: green;
                padding: 10px 15px;
                border-radius: 8px;
                box-shadow: 0 2px 5px rgba(0,0,0,0.2);
                opacity: 0;
                transition: opacity 0.3s;">
        {% for category, message in messages %}
            <div style="display: inline-block; padding: 10px 20px; border-radius: 6px;
                        background-color: {{ 'lightgreen' if category == 'success' else '#f8d7da' }};
                        color: {{ 'green' if category == 'success' else '#721c24' }};">
            {{ message }}
            </div>
        {% endfor %}
        </div>
    {% endif %}
    {% endwith %}

    <!-- T√¨m ki·∫øm ƒë·ªÅ thi -->
     <form method="get" action="{{ url_for('upload.danh_sach_de_thi') }}" style="text-align: center; margin-bottom: 20px;">
        <input type="text" name="search_id" placeholder="Nh·∫≠p m√£ ƒë·ªÅ thi..." value="{{ request.args.get('search_id', '') }}" style="padding: 8px; font-size: 14px;">
        <button type="submit" style="padding: 8px 12px;">T√¨m</button>
    </form>

    <table>
        <thead>
            <tr>
                <th>STT</th>
                <th>M√£ ƒë·ªÅ</th>
                <th>T√™n ƒë·ªÅ thi</th>
                <th>S·ªë l∆∞·ª£ng l√†m b√†i</th>
                <th>S·ªë c√¢u TN</th>
                <th>ƒê√°p √°n ƒë·ªÅ g·ªëc</th>
                <th>Th·ªùi gian (ph√∫t)</th>
                <th>Cho xem ƒë√°p √°n</th>
                <th>Ng√†y t·∫°o</th>
                <th>Thao t√°c</th>
                <th>X√°c th·ª±c TT</th>
            </tr>
        </thead>
        <tbody>
            {% if dethi_list %}
                {% for id, ten, so_cau, dap_an, time, id_dapan, action, xt_hs, created, sl_hs in dethi_list %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td><a href="{{ url_for('upload.chinh_sua_de', id_dethi=id) }}" 
                                title="Nh·∫•n v√†o ƒë·ªÉ ch·ªânh s·ª≠a ƒë·ªÅ thi c√≥ m√£ {{ id }}"
                                style="font-family: Consolas, monospace;">{{ id }}</a>
                            <button onclick="copyToClipboard('{{ id }}')" 
                                title="Copy m√£ ƒë·ªÅ {{id}}" 
                                style="margin-left: -7px; border: none; background: none; cursor: pointer;">üóê</button>
                        </td>
                        <!-- <td><a href="{{ url_for('xuli_dethi.bailam', id_dethi=id) }}"  style="font-family: Consolas, monospace;">{{ id }}</a></td> -->
                        <td>{{ ten or "(ch∆∞a nh·∫≠p)" }}</td>
                        <!-- <td>{{loop.index0}}</td> -->
                         <td>
                            <a title="Nh·∫•n v√†o ƒë·ªÉ xem s·ªë l∆∞·ª£ng h·ªçc sinh ƒë√£ l√†m b√†i c·ªßa ƒë·ªÅ {{id}}" 
                            href="{{ url_for('xuli_dethi.bailam', id_dethi=id) }}" >{{ sl_hs }}
                            </a>
                        </td>
                        <td>{{ so_cau }}</td>
                        <td>{{ dap_an }}</td>
                        <td>{{ time }}</td>
                        <td>{{ "C√≥" if id_dapan else "Kh√¥ng" }}</td>
                        <td>{{ created[:19].replace("T", " ") }}</td>
                        <td style="width: 12%;"> 
                            <a class="quay-ve-btn {{ 'mo-khoa' if action == 0 else 'khoa' }}" 
                            href="{{ url_for('upload.toggle_khoa_de', id_dethi=id) }}"
                            title="Nh·∫•n v√†o ƒë·ªÉ {{ 'm·ªü kh√≥a' if action else 'kh√≥a' }} ƒë·ªÅ thi {{id}}"
                            onclick="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën {{ 'm·ªü kh√≥a' if action else 'kh√≥a' }} ƒë·ªÅ n√†y?')">
                                {{ 'M·ªü kh√≥a' if action else 'Kh√≥a' }}
                            </a> |
                            <a class="quay-ve-btn" 
                                title="Nh·∫•n v√†o ƒë·ªÉ x√≥a ƒë·ªÅ thi {{id}}"
                                href="{{ url_for('upload.xoa_de', id_dethi=id) }}" onclick="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën xo√° ƒë·ªÅ n√†y?')">Xo√°
                            </a>
                        </td>
                        <td title="C√°c tr∆∞·ªùng h·ªçc sinh c·∫ßn x√°c nh·∫≠n">
                            {% if xt_hs.strip() %}
                                {{ xt_hs }}
                            {% else %}
                                <span style="color: red;">Kh√¥ng c·∫ßn</span>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="11" style="text-align: center; font-style: italic; color: #666;">Kh√¥ng c√≥ ƒë·ªÅ thi n√†o trong CSDL c·ªßa b·∫°n!</td>
                </tr>
            {% endif %}
        </tbody>
    </table>

<!-- JavaScript ·∫©n sau 5 gi√¢y -->
<script>
  setTimeout(function() {
    var flash = document.getElementById('flash-message');
    if (flash) {
      flash.style.display = 'none';
    }
  }, 3000); // 5000 milliseconds = 5 gi√¢y


function copyToClipboard(text) {
    if (!navigator.clipboard) {
        // Fallback n·∫øu tr√¨nh duy·ªát c≈©
        const textarea = document.createElement("textarea");
        textarea.value = text;
        textarea.style.position = "fixed";
        textarea.style.opacity = 0;
        document.body.appendChild(textarea);
        textarea.focus();
        textarea.select();
        try {
            document.execCommand("copy");
            showCopiedMessage(text);
        } catch (err) {
            console.error("Fallback copy failed", err);
        }
        document.body.removeChild(textarea);
        return;
    }

    navigator.clipboard.writeText(text).then(function() {
        showCopiedMessage(text);
    }, function(err) {
        console.error("Copy failed", err);
    });
}

function showCopiedMessage(text) {
    const msg = document.createElement("div");
    msg.textContent = "‚úÖ ƒê√£ copy m√£ ƒë·ªÅ: " + text;
    msg.style.position = "fixed";
    msg.style.top = "20px";
    msg.style.right = "20px";
    msg.style.background = "#4CAF50";
    msg.style.color = "white";
    msg.style.padding = "10px 15px";
    msg.style.borderRadius = "8px";
    msg.style.boxShadow = "0 2px 5px rgba(0,0,0,0.2)";
    msg.style.zIndex = 9999;
    msg.style.opacity = 0;
    msg.style.transition = "opacity 0.3s";

    document.body.appendChild(msg);

    // L√†m m·ªù v√† ·∫©n sau 2.5s
    setTimeout(() => msg.style.opacity = 1, 10);
    setTimeout(() => {
        msg.style.opacity = 0;
        setTimeout(() => msg.remove(), 300);
    }, 2500);
}


window.addEventListener('DOMContentLoaded', () => {
    const flash = document.getElementById('flash-message');
    if (flash) {
        flash.style.opacity = 1;
        setTimeout(() => {
            flash.style.opacity = 0;
            setTimeout(() => {
                flash.remove();
            }, 500);
        }, 3000); // hi·ªán 3s r·ªìi m·ªù d·∫ßn
    }
});

</script>
</body>
</html>
